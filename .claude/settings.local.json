{
  "permissions": {
    "allow": [
      "Bash(npx tsc:*)",
      "Bash(git add:*)",
      "Bash(git commit:*)",
      "Bash(git push:*)",
      "Bash(head:*)",
      "Bash(git fetch:*)",
      "Bash(npm run build:*)",
      "Bash(dir \"C:\\\\MAMP\\\\htdocs\\\\rental-management-saas\\\\src\\\\app\\\\api\\\\rooms\" /s)",
      "Bash(git restore:*)",
      "Bash(curl:*)",
      "Bash(del \"C:\\\\MAMP\\\\htdocs\\\\rental-management-saas\\\\src\\\\app\\\\dashboard\\\\bookings\\\\page.tsx.backup\")",
      "Bash(npm run lint:*)",
      "Bash(npx eslint:*)",
      "Bash(ls:*)",
      "Bash(.ts \")",
      "Bash(dir \"C:\\\\MAMP\\\\htdocs\\\\rental-management-saas\\\\public\")",
      "Bash(npx prisma:*)",
      "Bash(npm install:*)",
      "Bash(npm run dev:*)",
      "Bash(timeout /t 5 /nobreak)",
      "Bash(node -e:*)",
      "Bash(node test-whatsapp.js:*)",
      "Bash(node check-message.js:*)",
      "WebSearch",
      "Bash(npx next build)",
      "Bash(node test-email.js:*)",
      "Bash(del \"C:\\\\MAMP\\\\htdocs\\\\rental-management-saas\\\\test-email.js\")",
      "Bash(timeout 20 npx next build:*)",
      "Bash(cat:*)",
      "Bash(grep:*)",
      "Bash(\"src/app/api/rooms/[id]/ical-sync/route.ts\")",
      "Bash(powershell -Command \"\n$content = @''\nimport { NextRequest, NextResponse } from ''next/server'';\nimport { getServerSession } from ''next-auth'';\nimport { authOptions } from ''@/lib/auth'';\nimport { prisma } from ''@/lib/prisma'';\nimport { generateBookingCode } from ''@/lib/bookingCode'';\nimport ICAL from ''ical.js'';\n\nexport async function POST\\(\n  req: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n\\) {\n  try {\n    const session = await getServerSession\\(authOptions\\);\n    if \\(!session?.user?.id\\) {\n      return NextResponse.json\\({ error: ''Non autorizzato'' }, { status: 401 }\\);\n    }\n\n    const { id: roomId } = await params;\n\n    const room = await prisma.room.findUnique\\({\n      where: { id: roomId },\n      include: { property: true },\n    }\\);\n\n    if \\(!room\\) {\n      return NextResponse.json\\({ error: ''Stanza non trovata'' }, { status: 404 }\\);\n    }\n\n    let totalImported = 0;\n    let totalRemoved = 0;\n    const results: any[] = [];\n\n    if \\(room.airbnbIcalUrl\\) {\n      const airbnbResult = await syncIcalFeed\\(roomId, room.airbnbIcalUrl, ''AIRBNB'', session.user.id\\);\n      results.push\\({ source: ''AIRBNB'', ...airbnbResult }\\);\n      totalImported += airbnbResult.imported;\n      totalRemoved += airbnbResult.removed || 0;\n    }\n\n    if \\(room.bookingComIcalUrl\\) {\n      const bookingResult = await syncIcalFeed\\(roomId, room.bookingComIcalUrl, ''BOOKING_COM'', session.user.id\\);\n      results.push\\({ source: ''BOOKING_COM'', ...bookingResult }\\);\n      totalImported += bookingResult.imported;\n      totalRemoved += bookingResult.removed || 0;\n    }\n\n    await prisma.room.update\\({\n      where: { id: roomId },\n      data: { lastSyncedAt: new Date\\(\\) },\n    }\\);\n\n    return NextResponse.json\\({ success: true, totalImported, totalRemoved, results }\\);\n  } catch \\(error: any\\) {\n    console.error\\(''Errore durante la sincronizzazione iCal:'', error\\);\n    return NextResponse.json\\({ error: ''Errore durante la sincronizzazione'', details: error.message }, { status: 500 }\\);\n  }\n}\n''@\nSet-Content -Path ''src/app/api/rooms/[id]/ical-sync/route.ts'' -Value $content -Encoding UTF8\n\")"
    ]
  }
}
